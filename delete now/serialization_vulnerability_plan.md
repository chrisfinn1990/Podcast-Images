# Plan: Exploring Remote Code Execution (RCE) via Insecure Deserialization

## 1. Objective

To create a controlled, sandboxed environment to study, demonstrate, and understand how insecure deserialization of data can lead to Remote Code Execution (RCE). This entire setup is contained within the project's virtual environment (`venv`) for safety and isolation.

## 2. Background: What is Insecure Deserialization?

*   **Serialization:** The process of converting an in-memory object (like a Python class instance) into a stream of bytes (a string) for storage or transmission.
*   **Deserialization:** The reverse process of taking a stream of bytes and reconstructing the original object in memory.
*   **The Vulnerability:** Insecure Deserialization occurs when an application deserializes data from an untrusted source (like a user, a file, or a network socket) without proper validation. If the deserialization process can be manipulated to create unexpected object types, it can lead to arbitrary code execution. This is a common vulnerability, listed in the OWASP Top 10 (A08:2021 - Software and Data Integrity Failures).

## 3. The Lab Setup

We will use the `PyYAML` library in Python as our case study. Older versions of this library, or modern versions used improperly, are classic examples of this vulnerability.

### Step 1: Dependency

The `PyYAML` library will be added to `requirements.txt`. This library is used for parsing YAML data. The function `yaml.load()` is dangerous because it can construct any Python object, while `yaml.safe_load()` is the secure alternative that limits object creation to simple types.

### Step 2: The Vulnerable Code (`vulnerable_deserializer.py`)

A new Python script will be created to simulate a service that deserializes user-provided data. It will contain:
1.  A **vulnerable function** that uses `yaml.load()`.
2.  A **malicious payload** crafted in YAML format. This payload won't just represent data; it will instruct the `yaml.load()` function to execute an OS command.
3.  A **safe function** that uses `yaml.safe_load()` to show the correct, secure way to handle the same payload.

### Step 3: Execution and Observation

By running `vulnerable_deserializer.py` from the command line within the activated `venv`, we can observe the following:
*   When the malicious payload is passed to the **vulnerable function**, it will execute a system command (e.g., print a message to the console), demonstrating a successful RCE attack.
*   When the same payload is passed to the **safe function**, it will raise an error, demonstrating how proper validation prevents the attack.

## 4. Mitigation Strategy

The primary mitigation is simple and effective:

> **Never deserialize data from untrusted sources without strict validation.**

For `PyYAML`, this means **always use `yaml.safe_load()` instead of `yaml.load()`**. For other serialization formats like `pickle`, the recommendation is to never deserialize data from any untrusted source, as there is no "safe" mode.

This plan provides a clear, hands-on path to manipulating and understanding this critical vulnerability, all while keeping the experiment safely contained.